<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HD BAS 29.3.1 Generator - UI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 40px;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
        }
        
        .template-selector {
            margin-bottom: 20px;
        }
        
        .output-section {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .xml-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .device-list, .rule-list {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            margin-top: 15px;
        }
        
        .device-item, .rule-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .remove-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .add-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¢ HD BAS 29.3.1 Generator</h1>
            <p>Building Automation System XML Configuration Generator</p>
        </div>
        
        <div class="main-content">
            <div class="template-selector">
                <label for="template">í…œí”Œë¦¿ ì„ íƒ:</label>
                <select id="template" onchange="loadTemplate()">
                    <option value="">ì‚¬ìš©ì ì •ì˜</option>
                    <option value="basic">ê¸°ë³¸ BAS ì„¤ì •</option>
                    <option value="advanced">ê³ ê¸‰ BAS ì„¤ì •</option>
                </select>
            </div>
            
            <!-- System Information Section -->
            <div class="form-section">
                <h3>ğŸ”§ ì‹œìŠ¤í…œ ì •ë³´</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="system-name">ì‹œìŠ¤í…œ ì´ë¦„:</label>
                        <input type="text" id="system-name" value="HD-BAS-System" placeholder="ì‹œìŠ¤í…œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="form-group">
                        <label for="description">ì„¤ëª…:</label>
                        <input type="text" id="description" value="Generated by HD UI BAS Generator" placeholder="ì‹œìŠ¤í…œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                </div>
            </div>
            
            <!-- Devices Section -->
            <div class="form-section">
                <h3>ğŸ  ì¥ì¹˜ ì„¤ì •</h3>
                <button class="add-btn" onclick="addDevice()">+ ì¥ì¹˜ ì¶”ê°€</button>
                <div id="devices-list" class="device-list">
                    <!-- Devices will be added dynamically -->
                </div>
            </div>
            
            <!-- Automation Rules Section -->
            <div class="form-section">
                <h3>âš™ï¸ ìë™í™” ê·œì¹™</h3>
                <button class="add-btn" onclick="addRule()">+ ê·œì¹™ ì¶”ê°€</button>
                <div id="rules-list" class="rule-list">
                    <!-- Rules will be added dynamically -->
                </div>
            </div>
            
            <!-- UI Configuration Section -->
            <div class="form-section">
                <h3>ğŸ¨ UI ì„¤ì •</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="theme">í…Œë§ˆ:</label>
                        <select id="theme">
                            <option value="default">ê¸°ë³¸</option>
                            <option value="hd-theme">HD í…Œë§ˆ</option>
                            <option value="hd-advanced-theme">HD ê³ ê¸‰ í…Œë§ˆ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="language">ì–¸ì–´:</label>
                        <select id="language">
                            <option value="ko">í•œêµ­ì–´</option>
                            <option value="en">English</option>
                            <option value="ja">æ—¥æœ¬èª</option>
                            <option value="zh">ä¸­æ–‡</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="refresh-interval">ìƒˆë¡œê³ ì¹¨ ê°„ê²© (ì´ˆ):</label>
                        <input type="number" id="refresh-interval" value="30" min="1" max="300">
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="text-align: center; margin: 30px 0;">
                <button class="btn" onclick="generateXML()">ğŸ”„ XML ìƒì„±</button>
                <button class="btn btn-secondary" onclick="validateXML()">âœ… ìœ íš¨ì„± ê²€ì‚¬</button>
                <button class="btn btn-success" onclick="downloadXML()">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
            </div>
            
            <!-- Status Messages -->
            <div id="status-messages"></div>
            
            <!-- Output Section -->
            <div class="output-section">
                <h3>ğŸ“„ ìƒì„±ëœ XML</h3>
                <div id="xml-output" class="xml-output">
                    ì—¬ê¸°ì— ìƒì„±ëœ XMLì´ í‘œì‹œë©ë‹ˆë‹¤...
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let deviceCounter = 0;
        let ruleCounter = 0;
        let generatedXML = '';
        
        // Template configurations
        const templates = {
            basic: {
                systemName: "HD-BAS-Basic",
                description: "Basic Building Automation System Configuration",
                theme: "hd-theme",
                language: "ko",
                refreshInterval: 30,
                devices: [
                    {
                        id: "hvac-001",
                        type: "hvac",
                        name: "Main HVAC Unit",
                        location: "Building A - Floor 1",
                        protocol: "BACnet"
                    }
                ],
                rules: [
                    {
                        id: "energy-save-001",
                        name: "Energy Saving Rule",
                        description: "Turn off HVAC when no occupancy",
                        enabled: true
                    }
                ]
            },
            advanced: {
                systemName: "HD-BAS-Advanced",
                description: "Advanced Building Automation System with Full Integration",
                theme: "hd-advanced-theme",
                language: "ko",
                refreshInterval: 15,
                devices: [
                    {
                        id: "hvac-001",
                        type: "hvac",
                        name: "Central HVAC System",
                        location: "Mechanical Room",
                        protocol: "BACnet"
                    },
                    {
                        id: "lighting-001",
                        type: "lighting",
                        name: "LED Lighting Controller",
                        location: "Building Wide",
                        protocol: "DALI"
                    }
                ],
                rules: [
                    {
                        id: "energy-optimization-001",
                        name: "Energy Optimization",
                        description: "Comprehensive energy saving automation",
                        enabled: true
                    }
                ]
            }
        };
        
        function loadTemplate() {
            const templateSelect = document.getElementById('template');
            const templateName = templateSelect.value;
            
            if (!templateName) return;
            
            const template = templates[templateName];
            if (!template) return;
            
            // Load system info
            document.getElementById('system-name').value = template.systemName;
            document.getElementById('description').value = template.description;
            document.getElementById('theme').value = template.theme;
            document.getElementById('language').value = template.language;
            document.getElementById('refresh-interval').value = template.refreshInterval;
            
            // Clear existing devices and rules
            document.getElementById('devices-list').innerHTML = '';
            document.getElementById('rules-list').innerHTML = '';
            deviceCounter = 0;
            ruleCounter = 0;
            
            // Load devices
            template.devices.forEach(device => {
                addDevice(device);
            });
            
            // Load rules
            template.rules.forEach(rule => {
                addRule(rule);
            });
            
            showMessage('í…œí”Œë¦¿ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        function addDevice(deviceData = null) {
            deviceCounter++;
            const devicesList = document.getElementById('devices-list');
            
            const deviceDiv = document.createElement('div');
            deviceDiv.className = 'device-item';
            deviceDiv.id = `device-${deviceCounter}`;
            
            const data = deviceData || {
                id: `device-${deviceCounter}`,
                type: 'hvac',
                name: `Device ${deviceCounter}`,
                location: 'Building A',
                protocol: 'BACnet'
            };
            
            deviceDiv.innerHTML = `
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                    <strong>ì¥ì¹˜ #${deviceCounter}</strong>
                    <button class="remove-btn" onclick="removeDevice('device-${deviceCounter}')">ì œê±°</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ì¥ì¹˜ ID:</label>
                        <input type="text" value="${data.id}" data-field="id">
                    </div>
                    <div class="form-group">
                        <label>ì¥ì¹˜ ìœ í˜•:</label>
                        <select data-field="type">
                            <option value="hvac" ${data.type === 'hvac' ? 'selected' : ''}>HVAC</option>
                            <option value="lighting" ${data.type === 'lighting' ? 'selected' : ''}>ì¡°ëª…</option>
                            <option value="security" ${data.type === 'security' ? 'selected' : ''}>ë³´ì•ˆ</option>
                            <option value="occupancy" ${data.type === 'occupancy' ? 'selected' : ''}>ì ìœ ê°ì§€</option>
                            <option value="energy" ${data.type === 'energy' ? 'selected' : ''}>ì—ë„ˆì§€</option>
                            <option value="fire-safety" ${data.type === 'fire-safety' ? 'selected' : ''}>í™”ì¬ì•ˆì „</option>
                            <option value="access-control" ${data.type === 'access-control' ? 'selected' : ''}>ì¶œì…í†µì œ</option>
                            <option value="elevator" ${data.type === 'elevator' ? 'selected' : ''}>ì—˜ë¦¬ë² ì´í„°</option>
                            <option value="water-management" ${data.type === 'water-management' ? 'selected' : ''}>ë¬¼ ê´€ë¦¬</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ì¥ì¹˜ ì´ë¦„:</label>
                        <input type="text" value="${data.name}" data-field="name">
                    </div>
                    <div class="form-group">
                        <label>ìœ„ì¹˜:</label>
                        <input type="text" value="${data.location}" data-field="location">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>í”„ë¡œí† ì½œ:</label>
                        <select data-field="protocol">
                            <option value="BACnet" ${data.protocol === 'BACnet' ? 'selected' : ''}>BACnet</option>
                            <option value="Modbus" ${data.protocol === 'Modbus' ? 'selected' : ''}>Modbus</option>
                            <option value="DALI" ${data.protocol === 'DALI' ? 'selected' : ''}>DALI</option>
                            <option value="KNX" ${data.protocol === 'KNX' ? 'selected' : ''}>KNX</option>
                            <option value="MQTT" ${data.protocol === 'MQTT' ? 'selected' : ''}>MQTT</option>
                            <option value="LonWorks" ${data.protocol === 'LonWorks' ? 'selected' : ''}>LonWorks</option>
                            <option value="HTTP" ${data.protocol === 'HTTP' ? 'selected' : ''}>HTTP</option>
                            <option value="TCP" ${data.protocol === 'TCP' ? 'selected' : ''}>TCP</option>
                        </select>
                    </div>
                </div>
            `;
            
            devicesList.appendChild(deviceDiv);
        }
        
        function addRule(ruleData = null) {
            ruleCounter++;
            const rulesList = document.getElementById('rules-list');
            
            const ruleDiv = document.createElement('div');
            ruleDiv.className = 'rule-item';
            ruleDiv.id = `rule-${ruleCounter}`;
            
            const data = ruleData || {
                id: `rule-${ruleCounter}`,
                name: `Rule ${ruleCounter}`,
                description: 'Automation rule description',
                enabled: true
            };
            
            ruleDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <strong>ê·œì¹™ #${ruleCounter}</strong>
                    <button class="remove-btn" onclick="removeRule('rule-${ruleCounter}')">ì œê±°</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ê·œì¹™ ID:</label>
                        <input type="text" value="${data.id}" data-field="id">
                    </div>
                    <div class="form-group">
                        <label>ê·œì¹™ ì´ë¦„:</label>
                        <input type="text" value="${data.name}" data-field="name">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ì„¤ëª…:</label>
                        <textarea rows="2" data-field="description">${data.description}</textarea>
                    </div>
                    <div class="form-group">
                        <label>í™œì„±í™”:</label>
                        <select data-field="enabled">
                            <option value="true" ${data.enabled ? 'selected' : ''}>ì˜ˆ</option>
                            <option value="false" ${!data.enabled ? 'selected' : ''}>ì•„ë‹ˆì˜¤</option>
                        </select>
                    </div>
                </div>
            `;
            
            rulesList.appendChild(ruleDiv);
        }
        
        function removeDevice(deviceId) {
            document.getElementById(deviceId).remove();
        }
        
        function removeRule(ruleId) {
            document.getElementById(ruleId).remove();
        }
        
        function collectFormData() {
            const data = {
                system_name: document.getElementById('system-name').value,
                description: document.getElementById('description').value,
                devices: [],
                automation: [],
                ui_config: {
                    theme: document.getElementById('theme').value,
                    language: document.getElementById('language').value,
                    refresh_interval: parseInt(document.getElementById('refresh-interval').value),
                    dashboards: [
                        {id: "main", name: "ë©”ì¸ ëŒ€ì‹œë³´ë“œ", layout: "grid"}
                    ]
                }
            };
            
            // Collect devices
            const deviceElements = document.querySelectorAll('.device-item');
            deviceElements.forEach(deviceEl => {
                const device = {
                    id: deviceEl.querySelector('[data-field="id"]').value,
                    type: deviceEl.querySelector('[data-field="type"]').value,
                    name: deviceEl.querySelector('[data-field="name"]').value,
                    location: deviceEl.querySelector('[data-field="location"]').value,
                    protocol: deviceEl.querySelector('[data-field="protocol"]').value,
                    properties: {}
                };
                data.devices.push(device);
            });
            
            // Collect rules
            const ruleElements = document.querySelectorAll('.rule-item');
            ruleElements.forEach(ruleEl => {
                const rule = {
                    id: ruleEl.querySelector('[data-field="id"]').value,
                    name: ruleEl.querySelector('[data-field="name"]').value,
                    description: ruleEl.querySelector('[data-field="description"]').value,
                    enabled: ruleEl.querySelector('[data-field="enabled"]').value === 'true',
                    conditions: [],
                    actions: []
                };
                data.automation.push(rule);
            });
            
            return data;
        }
        
        async function generateXML() {
            const config = collectFormData();
            // Try server-side generation first for strict validation and determinism
            try {
                const resp = await fetch('/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (resp.ok) {
                    const data = await resp.json();
                    if (data.success && data.xml) {
                        generatedXML = data.xml;
                        document.getElementById('xml-output').textContent = data.xml;
                        showMessage('ì„œë²„ì—ì„œ XMLì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                        return;
                    }
                    throw new Error(data.error || 'Unknown server error');
                }
                // Non-200 -> fallback
                throw new Error('Server generation failed');
            } catch (e) {
                // Fallback to client-side generation
                try {
                    const xml = generateBASXML(config);
                    generatedXML = xml;
                    document.getElementById('xml-output').textContent = xml;
                    showMessage('í´ë¼ì´ì–¸íŠ¸ì—ì„œ XMLì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤. (ì„œë²„ ì‹¤íŒ¨ë¡œ ì¸í•œ ëŒ€ì²´)', 'success');
                } catch (err) {
                    showMessage('XML ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + err.message, 'error');
                }
            }
        }
        
        function generateBASXML(config) {
            const now = new Date().toISOString();
            let xml = `<?xml version="1.0" encoding="UTF-8"?>
<bas-config xmlns="http://bas.hd.ui.xml/29.3.1" 
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://bas.hd.ui.xml/29.3.1 http://bas.hd.ui.xml/29.3.1/bas-schema.xsd"
            version="29.3.1" 
            generated="${now}">
            
  <system-info>
    <name>${escapeXml(config.system_name)}</name>
    <description>${escapeXml(config.description)}</description>
    <version>29.3.1</version>
  </system-info>
  
  <devices>`;
            
            config.devices.forEach(device => {
                xml += `
    <device id="${escapeXml(device.id)}" type="${device.type}">
      <name>${escapeXml(device.name)}</name>
      <location>${escapeXml(device.location)}</location>
      <protocol>${device.protocol}</protocol>
      <properties>
        <property name="status">active</property>
      </properties>
    </device>`;
            });
            
            xml += `
  </devices>
  
  <automation>`;
            
            config.automation.forEach(rule => {
                xml += `
    <rule id="${escapeXml(rule.id)}" enabled="${rule.enabled}">
      <name>${escapeXml(rule.name)}</name>
      <description>${escapeXml(rule.description)}</description>
      <conditions>
        <condition device="example-device" property="status" operator="equals">active</condition>
      </conditions>
      <actions>
        <action device="example-device" property="power">on</action>
      </actions>
    </rule>`;
            });
            
            xml += `
  </automation>
  
  <ui-configuration>
    <theme>${config.ui_config.theme}</theme>
    <language>${config.ui_config.language}</language>
    <refresh-interval>${config.ui_config.refresh_interval}</refresh-interval>
    <dashboards>`;
            
            config.ui_config.dashboards.forEach(dashboard => {
                xml += `
      <dashboard id="${escapeXml(dashboard.id)}">
        <name>${escapeXml(dashboard.name)}</name>
        <layout>${dashboard.layout}</layout>
      </dashboard>`;
            });
            
            xml += `
    </dashboards>
  </ui-configuration>
  
</bas-config>`;
            
            return xml;
        }
        
        function escapeXml(text) {
            return text.toString()
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }
        
        async function validateXML() {
            if (!generatedXML) {
                showMessage('ë¨¼ì € XMLì„ ìƒì„±í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            // Try server-side XSD validation first
            try {
                const resp = await fetch('/validate-xsd', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ xml: generatedXML })
                });
                const data = await resp.json();
                if (resp.status === 200 && data.success) {
                    showMessage('XSD ìœ íš¨ì„± ê²€ì‚¬ ì„±ê³µ!', 'success');
                    return;
                }
                if (data && Array.isArray(data.errors) && data.errors.length) {
                    showMessage('XSD ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨: ' + data.errors[0], 'error');
                    return;
                }
                throw new Error('Server validation failed');
            } catch (e) {
                // Fallback to basic XML well-formedness check
                try {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(generatedXML, 'application/xml');
                    const parseError = xmlDoc.querySelector('parsererror');
                    if (parseError) {
                        showMessage('XML êµ¬ë¬¸ ì˜¤ë¥˜: ' + parseError.textContent, 'error');
                    } else {
                        showMessage('ê¸°ë³¸ êµ¬ë¬¸ ê²€ì‚¬ëŠ” í†µê³¼í–ˆìŠµë‹ˆë‹¤.', 'success');
                    }
                } catch (err) {
                    showMessage('XML ìœ íš¨ì„± ê²€ì‚¬ ì¤‘ ì˜¤ë¥˜: ' + err.message, 'error');
                }
            }
        }
        
        function downloadXML() {
            if (!generatedXML) {
                showMessage('ë¨¼ì € XMLì„ ìƒì„±í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const blob = new Blob([generatedXML], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bas_config_29.3.1.xml';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage('XML íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        function showMessage(message, type) {
            const messagesDiv = document.getElementById('status-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `status-message ${type}`;
            messageDiv.textContent = message;
            
            messagesDiv.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
        
        // Initialize with one device and one rule
        document.addEventListener('DOMContentLoaded', function() {
            addDevice();
            addRule();
        });
    </script>
</body>
</html>