<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HD BAS 29.3.1 Generator - UI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 40px;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
        }
        
        .template-selector {
            margin-bottom: 20px;
        }
        
        .output-section {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .xml-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .device-list, .rule-list {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            margin-top: 15px;
        }
        
        .device-item, .rule-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        
        .remove-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .add-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ HD BAS 29.3.1 Generator</h1>
            <p>Building Automation System XML Configuration Generator</p>
        </div>
        
        <div class="main-content">
            <div class="template-selector">
                <label for="template">ÌÖúÌîåÎ¶ø ÏÑ†ÌÉù:</label>
                <select id="template" onchange="loadTemplate()">
                    <option value="">ÏÇ¨Ïö©Ïûê Ï†ïÏùò</option>
                    <option value="basic">Í∏∞Î≥∏ BAS ÏÑ§Ï†ï</option>
                    <option value="advanced">Í≥†Í∏â BAS ÏÑ§Ï†ï</option>
                </select>
            </div>
            
            <!-- System Information Section -->
            <div class="form-section">
                <h3>üîß ÏãúÏä§ÌÖú Ï†ïÎ≥¥</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="system-name">ÏãúÏä§ÌÖú Ïù¥Î¶Ñ:</label>
                        <input type="text" id="system-name" value="HD-BAS-System" placeholder="ÏãúÏä§ÌÖú Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                    </div>
                    <div class="form-group">
                        <label for="description">ÏÑ§Î™Ö:</label>
                        <input type="text" id="description" value="Generated by HD UI BAS Generator" placeholder="ÏãúÏä§ÌÖú ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                    </div>
                </div>
            </div>
            
            <!-- Devices Section -->
            <div class="form-section">
                <h3>üè† Ïû•Ïπò ÏÑ§Ï†ï</h3>
                <button class="add-btn" onclick="addDevice()">+ Ïû•Ïπò Ï∂îÍ∞Ä</button>
                <div id="devices-list" class="device-list">
                    <!-- Devices will be added dynamically -->
                </div>
            </div>
            
            <!-- Automation Rules Section -->
            <div class="form-section">
                <h3>‚öôÔ∏è ÏûêÎèôÌôî Í∑úÏπô</h3>
                <button class="add-btn" onclick="addRule()">+ Í∑úÏπô Ï∂îÍ∞Ä</button>
                <div id="rules-list" class="rule-list">
                    <!-- Rules will be added dynamically -->
                </div>
            </div>
            
            <!-- UI Configuration Section -->
            <div class="form-section">
                <h3>üé® UI ÏÑ§Ï†ï</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="theme">ÌÖåÎßà:</label>
                        <select id="theme">
                            <option value="default">Í∏∞Î≥∏</option>
                            <option value="hd-theme">HD ÌÖåÎßà</option>
                            <option value="hd-advanced-theme">HD Í≥†Í∏â ÌÖåÎßà</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="language">Ïñ∏Ïñ¥:</label>
                        <select id="language">
                            <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                            <option value="en">English</option>
                            <option value="ja">Êó•Êú¨Ë™û</option>
                            <option value="zh">‰∏≠Êñá</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="refresh-interval">ÏÉàÎ°úÍ≥†Ïπ® Í∞ÑÍ≤© (Ï¥à):</label>
                        <input type="number" id="refresh-interval" value="30" min="1" max="300">
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="text-align: center; margin: 30px 0;">
                <button class="btn" onclick="generateXML()">üîÑ XML ÏÉùÏÑ±</button>
                <button class="btn btn-secondary" onclick="validateXML()">‚úÖ Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨</button>
                <button class="btn btn-success" onclick="downloadXML()">üíæ Îã§Ïö¥Î°úÎìú</button>
            </div>
            
            <!-- Status Messages -->
            <div id="status-messages"></div>
            
            <!-- Output Section -->
            <div class="output-section">
                <h3>üìÑ ÏÉùÏÑ±Îêú XML</h3>
                <div id="xml-output" class="xml-output">
                    Ïó¨Í∏∞Ïóê ÏÉùÏÑ±Îêú XMLÏù¥ ÌëúÏãúÎê©ÎãàÎã§...
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let deviceCounter = 0;
        let ruleCounter = 0;
        let generatedXML = '';
        
        // Template configurations
        const templates = {
            basic: {
                systemName: "HD-BAS-Basic",
                description: "Basic Building Automation System Configuration",
                theme: "hd-theme",
                language: "ko",
                refreshInterval: 30,
                devices: [
                    {
                        id: "hvac-001",
                        type: "hvac",
                        name: "Main HVAC Unit",
                        location: "Building A - Floor 1",
                        protocol: "BACnet"
                    }
                ],
                rules: [
                    {
                        id: "energy-save-001",
                        name: "Energy Saving Rule",
                        description: "Turn off HVAC when no occupancy",
                        enabled: true
                    }
                ]
            },
            advanced: {
                systemName: "HD-BAS-Advanced",
                description: "Advanced Building Automation System with Full Integration",
                theme: "hd-advanced-theme",
                language: "ko",
                refreshInterval: 15,
                devices: [
                    {
                        id: "hvac-001",
                        type: "hvac",
                        name: "Central HVAC System",
                        location: "Mechanical Room",
                        protocol: "BACnet"
                    },
                    {
                        id: "lighting-001",
                        type: "lighting",
                        name: "LED Lighting Controller",
                        location: "Building Wide",
                        protocol: "DALI"
                    }
                ],
                rules: [
                    {
                        id: "energy-optimization-001",
                        name: "Energy Optimization",
                        description: "Comprehensive energy saving automation",
                        enabled: true
                    }
                ]
            }
        };
        
        function loadTemplate() {
            const templateSelect = document.getElementById('template');
            const templateName = templateSelect.value;
            
            if (!templateName) return;
            
            const template = templates[templateName];
            if (!template) return;
            
            // Load system info
            document.getElementById('system-name').value = template.systemName;
            document.getElementById('description').value = template.description;
            document.getElementById('theme').value = template.theme;
            document.getElementById('language').value = template.language;
            document.getElementById('refresh-interval').value = template.refreshInterval;
            
            // Clear existing devices and rules
            document.getElementById('devices-list').innerHTML = '';
            document.getElementById('rules-list').innerHTML = '';
            deviceCounter = 0;
            ruleCounter = 0;
            
            // Load devices
            template.devices.forEach(device => {
                addDevice(device);
            });
            
            // Load rules
            template.rules.forEach(rule => {
                addRule(rule);
            });
            
            showMessage('ÌÖúÌîåÎ¶øÏù¥ Î°úÎìúÎêòÏóàÏäµÎãàÎã§.', 'success');
        }
        
        function addDevice(deviceData = null) {
            deviceCounter++;
            const devicesList = document.getElementById('devices-list');
            
            const deviceDiv = document.createElement('div');
            deviceDiv.className = 'device-item';
            deviceDiv.id = `device-${deviceCounter}`;
            
            const data = deviceData || {
                id: `device-${deviceCounter}`,
                type: 'hvac',
                name: `Device ${deviceCounter}`,
                location: 'Building A',
                protocol: 'BACnet'
            };
            
            deviceDiv.innerHTML = `
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                    <strong>Ïû•Ïπò #${deviceCounter}</strong>
                    <button class="remove-btn" onclick="removeDevice('device-${deviceCounter}')">Ï†úÍ±∞</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ïû•Ïπò ID:</label>
                        <input type="text" value="${data.id}" data-field="id">
                    </div>
                    <div class="form-group">
                        <label>Ïû•Ïπò Ïú†Ìòï:</label>
                        <select data-field="type">
                            <option value="hvac" ${data.type === 'hvac' ? 'selected' : ''}>HVAC</option>
                            <option value="lighting" ${data.type === 'lighting' ? 'selected' : ''}>Ï°∞Î™Ö</option>
                            <option value="security" ${data.type === 'security' ? 'selected' : ''}>Î≥¥Ïïà</option>
                            <option value="occupancy" ${data.type === 'occupancy' ? 'selected' : ''}>Ï†êÏú†Í∞êÏßÄ</option>
                            <option value="energy" ${data.type === 'energy' ? 'selected' : ''}>ÏóêÎÑàÏßÄ</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ïû•Ïπò Ïù¥Î¶Ñ:</label>
                        <input type="text" value="${data.name}" data-field="name">
                    </div>
                    <div class="form-group">
                        <label>ÏúÑÏπò:</label>
                        <input type="text" value="${data.location}" data-field="location">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ÌîÑÎ°úÌÜ†ÏΩú:</label>
                        <select data-field="protocol">
                            <option value="BACnet" ${data.protocol === 'BACnet' ? 'selected' : ''}>BACnet</option>
                            <option value="Modbus" ${data.protocol === 'Modbus' ? 'selected' : ''}>Modbus</option>
                            <option value="DALI" ${data.protocol === 'DALI' ? 'selected' : ''}>DALI</option>
                            <option value="KNX" ${data.protocol === 'KNX' ? 'selected' : ''}>KNX</option>
                            <option value="MQTT" ${data.protocol === 'MQTT' ? 'selected' : ''}>MQTT</option>
                        </select>
                    </div>
                </div>
            `;
            
            devicesList.appendChild(deviceDiv);
        }
        
        function addRule(ruleData = null) {
            ruleCounter++;
            const rulesList = document.getElementById('rules-list');
            
            const ruleDiv = document.createElement('div');
            ruleDiv.className = 'rule-item';
            ruleDiv.id = `rule-${ruleCounter}`;
            
            const data = ruleData || {
                id: `rule-${ruleCounter}`,
                name: `Rule ${ruleCounter}`,
                description: 'Automation rule description',
                enabled: true
            };
            
            ruleDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <strong>Í∑úÏπô #${ruleCounter}</strong>
                    <button class="remove-btn" onclick="removeRule('rule-${ruleCounter}')">Ï†úÍ±∞</button>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Í∑úÏπô ID:</label>
                        <input type="text" value="${data.id}" data-field="id">
                    </div>
                    <div class="form-group">
                        <label>Í∑úÏπô Ïù¥Î¶Ñ:</label>
                        <input type="text" value="${data.name}" data-field="name">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ÏÑ§Î™Ö:</label>
                        <textarea rows="2" data-field="description">${data.description}</textarea>
                    </div>
                    <div class="form-group">
                        <label>ÌôúÏÑ±Ìôî:</label>
                        <select data-field="enabled">
                            <option value="true" ${data.enabled ? 'selected' : ''}>Ïòà</option>
                            <option value="false" ${!data.enabled ? 'selected' : ''}>ÏïÑÎãàÏò§</option>
                        </select>
                    </div>
                </div>
            `;
            
            rulesList.appendChild(ruleDiv);
        }
        
        function removeDevice(deviceId) {
            document.getElementById(deviceId).remove();
        }
        
        function removeRule(ruleId) {
            document.getElementById(ruleId).remove();
        }
        
        function collectFormData() {
            const data = {
                system_name: document.getElementById('system-name').value,
                description: document.getElementById('description').value,
                devices: [],
                automation: [],
                ui_config: {
                    theme: document.getElementById('theme').value,
                    language: document.getElementById('language').value,
                    refresh_interval: parseInt(document.getElementById('refresh-interval').value),
                    dashboards: [
                        {id: "main", name: "Î©îÏù∏ ÎåÄÏãúÎ≥¥Îìú", layout: "grid"}
                    ]
                }
            };
            
            // Collect devices
            const deviceElements = document.querySelectorAll('.device-item');
            deviceElements.forEach(deviceEl => {
                const device = {
                    id: deviceEl.querySelector('[data-field="id"]').value,
                    type: deviceEl.querySelector('[data-field="type"]').value,
                    name: deviceEl.querySelector('[data-field="name"]').value,
                    location: deviceEl.querySelector('[data-field="location"]').value,
                    protocol: deviceEl.querySelector('[data-field="protocol"]').value,
                    properties: {}
                };
                data.devices.push(device);
            });
            
            // Collect rules
            const ruleElements = document.querySelectorAll('.rule-item');
            ruleElements.forEach(ruleEl => {
                const rule = {
                    id: ruleEl.querySelector('[data-field="id"]').value,
                    name: ruleEl.querySelector('[data-field="name"]').value,
                    description: ruleEl.querySelector('[data-field="description"]').value,
                    enabled: ruleEl.querySelector('[data-field="enabled"]').value === 'true',
                    conditions: [],
                    actions: []
                };
                data.automation.push(rule);
            });
            
            return data;
        }
        
        function generateXML() {
            try {
                const config = collectFormData();
                
                // Generate XML (simplified client-side version)
                const xml = generateBASXML(config);
                generatedXML = xml;
                
                document.getElementById('xml-output').textContent = xml;
                showMessage('XMLÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!', 'success');
            } catch (error) {
                showMessage('XML ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
            }
        }
        
        function generateBASXML(config) {
            const now = new Date().toISOString();
            let xml = `<?xml version="1.0" encoding="UTF-8"?>
<bas-config xmlns="http://bas.hd.ui.xml/29.3.1" 
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://bas.hd.ui.xml/29.3.1 http://bas.hd.ui.xml/29.3.1/bas-schema.xsd"
            version="29.3.1" 
            generated="${now}">
            
  <system-info>
    <name>${escapeXml(config.system_name)}</name>
    <description>${escapeXml(config.description)}</description>
    <version>29.3.1</version>
  </system-info>
  
  <devices>`;
            
            config.devices.forEach(device => {
                xml += `
    <device id="${escapeXml(device.id)}" type="${device.type}">
      <name>${escapeXml(device.name)}</name>
      <location>${escapeXml(device.location)}</location>
      <protocol>${device.protocol}</protocol>
      <properties>
        <property name="status">active</property>
      </properties>
    </device>`;
            });
            
            xml += `
  </devices>
  
  <automation>`;
            
            config.automation.forEach(rule => {
                xml += `
    <rule id="${escapeXml(rule.id)}" enabled="${rule.enabled}">
      <name>${escapeXml(rule.name)}</name>
      <description>${escapeXml(rule.description)}</description>
      <conditions>
        <condition device="example-device" property="status" operator="equals">active</condition>
      </conditions>
      <actions>
        <action device="example-device" property="power">on</action>
      </actions>
    </rule>`;
            });
            
            xml += `
  </automation>
  
  <ui-configuration>
    <theme>${config.ui_config.theme}</theme>
    <language>${config.ui_config.language}</language>
    <refresh-interval>${config.ui_config.refresh_interval}</refresh-interval>
    <dashboards>`;
            
            config.ui_config.dashboards.forEach(dashboard => {
                xml += `
      <dashboard id="${escapeXml(dashboard.id)}">
        <name>${escapeXml(dashboard.name)}</name>
        <layout>${dashboard.layout}</layout>
      </dashboard>`;
            });
            
            xml += `
    </dashboards>
  </ui-configuration>
  
</bas-config>`;
            
            return xml;
        }
        
        function escapeXml(text) {
            return text.toString()
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }
        
        function validateXML() {
            if (!generatedXML) {
                showMessage('Î®ºÏ†Ä XMLÏùÑ ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(generatedXML, 'application/xml');
                
                const parseError = xmlDoc.querySelector('parsererror');
                if (parseError) {
                    showMessage('XML Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ Ïã§Ìå®: ' + parseError.textContent, 'error');
                } else {
                    showMessage('XML Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ ÏÑ±Í≥µ! BAS 29.3.1 ÌëúÏ§ÄÏùÑ Ï§ÄÏàòÌï©ÎãàÎã§.', 'success');
                }
            } catch (error) {
                showMessage('XML Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ Ï§ë Ïò§Î•ò: ' + error.message, 'error');
            }
        }
        
        function downloadXML() {
            if (!generatedXML) {
                showMessage('Î®ºÏ†Ä XMLÏùÑ ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            const blob = new Blob([generatedXML], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bas_config_29.3.1.xml';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage('XML ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.', 'success');
        }
        
        function showMessage(message, type) {
            const messagesDiv = document.getElementById('status-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `status-message ${type}`;
            messageDiv.textContent = message;
            
            messagesDiv.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
        
        // Initialize with one device and one rule
        document.addEventListener('DOMContentLoaded', function() {
            addDevice();
            addRule();
        });
    </script>
</body>
</html>